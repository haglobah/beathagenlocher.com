---
export interface Props {
  topics: string[];
  size?: string;
}
const { topics, size } = Astro.props;
import Badge from './Badge.astro';
import { slug } from 'github-slugger';
---

<div class="topic-filter">
  <div id="selected-topics" class="flex justify-between flex-wrap f-my-lg relative min-h-[40px] items-center">
    <!-- Initial instruction text that will be hidden when topics are selected -->
    <div class="flex flex-wrap items-center basis-4/5">
      <div id="no-selection-text" class="text-zinc-400 px-2 group/emptyselectiontext">
        Select topics from here <span class="i-heroicons:arrow-down-20-solid inline-block relative mx-3 top-1 size-6 group-hover/emptyselectiontext:bg-zinc-100 transition-all duration-400 group-hover/emptyselectiontext:scale-150 ease-in-out"></span> to filter content
      </div>
      
      <!-- Text that appears when topics are selected -->
      <div id="has-selection-text" class="text-zinc-400 italic px-2 hidden">
        Click topic here <span class="i-heroicons:arrow-left-20-solid inline-block relative mx-3 top-1 size-6 group-hover/emptyselectiontext:bg-zinc-100 transition-all duration-400 group-hover/emptyselectiontext:scale-150 ease-in-out"></span> to remove filter
      </div>
    </div>
    {topics.length > 0 && (
      <div class="">
        <button id="clear-topics" class="basis-1/5 mx-auto bg-zinc-800 border border-cornflower text-cornflower hover:bg-cornflower/10 font-medium py-2 px-4 rounded-md transition duration-300 ease-in-out">
          Clear filters
        </button>
      </div>
    )}
  </div>

  <div id="available-topics" class="flex flex-wrap f-my-lg">
    {topics.map(topic =>
      <div id={"btn-" + slug(topic)} data-topic={topic} class="topic-button cursor-pointer">
        <Badge topic={topic} size={size}>
      </div>
    )}
  </div>
</div>

<script>
  import { selectedTopics, toggleTopic, clearTopics } from '../store.js';

  const availableTopics = document.querySelectorAll('.topic-button');
  const clearButton = document.getElementById('clear-topics');
  const noSelectionText = document.getElementById('no-selection-text');
  const hasSelectionText = document.getElementById('has-selection-text');

  // Initialize UI based on store state
  function updateUI() {
    const selected = selectedTopics.get();
    const availableContainer = document.querySelector('#available-topics');
    const selectedContainer = document.querySelector('#selected-topics');

    // Update text visibility based on selection state
    if (selected.length > 0) {
      noSelectionText.classList.add('hidden');
      hasSelectionText.classList.remove('hidden');
      clearButton.classList.remove('hidden');
    } else {
      noSelectionText.classList.remove('hidden');
      hasSelectionText.classList.add('hidden');
      clearButton.classList.add('hidden');
    }

    availableTopics.forEach((el) => {
      const topic = el.dataset.topic;
      const isSelected = selected.includes(topic);

      if (isSelected && el.parentNode !== selectedContainer) {
        // Move to selected and update styling
        selectedContainer.appendChild(el);
        // Insert after the has-selection-text element
        hasSelectionText.before(el);
        el.classList.remove();
        el.classList.add();
      } else if (!isSelected && el.parentNode !== availableContainer) {
        // Move back to available and restore original styling
        availableContainer.appendChild(el);
        el.classList.add();
        el.classList.remove();
      }
    });
  }

  // Set up event listeners
  availableTopics.forEach((el) => {
    el.addEventListener('click', () => {
      const topic = el.dataset.topic;
      toggleTopic(topic);
      updateUI();
    });
  });

  if (clearButton) {
    clearButton.addEventListener('click', () => {
      clearTopics();
      updateUI();
    });
  }

  // Subscribe to store changes
  selectedTopics.subscribe(updateUI);

  // Initial UI update
  updateUI();
</script>
